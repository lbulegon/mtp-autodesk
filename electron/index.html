<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MotoPro AutoDesk</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Layout de lista vertical para as vagas */
    .vagas-list {
      display: flex !important;
      flex-direction: column !important;
      gap: 12px !important;
      padding: 12px !important;
      height: 100% !important;
      width: 100% !important;
      min-width: 100% !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
      box-sizing: border-box !important;
    }
    
    /* Container principal do painel direito */
    .detail {
      display: flex !important;
      flex-direction: column !important;
      height: calc(100vh - 64px) !important;
      width: 100% !important;
      min-width: 100% !important;
      overflow: hidden !important;
      box-sizing: border-box !important;
    }
    
    /* Garantir que o container das vagas ocupe todo o espaÃ§o */
    #vagasLista {
      flex: 1 !important;
      width: 100% !important;
      min-width: 100% !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
      padding: 0 !important;
      box-sizing: border-box !important;
    }
    
    /* Estilos especÃ­ficos para o painel direito */
    .right .detail {
      height: calc(100vh - 64px) !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
    }
    
    /* Scroll personalizado */
    .vagas-list::-webkit-scrollbar,
    .detail::-webkit-scrollbar,
    #vagasLista::-webkit-scrollbar {
      width: 8px !important;
    }
    
    .vagas-list::-webkit-scrollbar-track,
    .detail::-webkit-scrollbar-track,
    #vagasLista::-webkit-scrollbar-track {
      background: #f1f1f1 !important;
      border-radius: 4px !important;
    }
    
    .vagas-list::-webkit-scrollbar-thumb,
    .detail::-webkit-scrollbar-thumb,
    #vagasLista::-webkit-scrollbar-thumb {
      background: #c1c1c1 !important;
      border-radius: 4px !important;
    }
    
    .vagas-list::-webkit-scrollbar-thumb:hover,
    .detail::-webkit-scrollbar-thumb:hover,
    #vagasLista::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8 !important;
    }
    
    .vaga-card {
      background: var(--card) !important;
      border: 1px solid var(--line) !important;
      border-radius: 12px !important;
      padding: 16px !important;
      transition: all 0.2s ease !important;
      cursor: pointer !important;
      position: relative !important;
      overflow: hidden !important;
      width: 100% !important;
      min-width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
      margin: 0 !important;
    }
    
    .vaga-card:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
      border-color: var(--primary) !important;
    }
    
    .vaga-header {
      display: flex !important;
      justify-content: space-between !important;
      align-items: center !important;
      margin-bottom: 12px !important;
    }
    
    .vaga-id {
      font-weight: 700 !important;
      font-size: 16px !important;
      color: var(--ink) !important;
    }
    
    .vaga-status {
      font-size: 11px !important;
      padding: 4px 8px !important;
      border-radius: 6px !important;
      font-weight: 600 !important;
      text-transform: uppercase !important;
      letter-spacing: 0.5px !important;
    }
    
    .vaga-status.aberta {
      background: #dcfce7 !important;
      color: #166534 !important;
    }
    
    .vaga-status.encerrada {
      background: #fee2e2 !important;
      color: #991b1b !important;
    }
    
    .vaga-info {
      display: flex !important;
      flex-wrap: wrap !important;
      gap: 16px !important;
      margin-bottom: 12px !important;
      align-items: center !important;
    }
    
    .vaga-estabelecimento {
      font-weight: 600 !important;
      color: #333 !important;
      font-size: 14px !important;
      flex: 1 !important;
      min-width: 200px !important;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    .vaga-horario,
    .vaga-data,
    .vaga-tipo,
    .vaga-local {
      color: #666 !important;
      font-size: 12px !important;
      white-space: nowrap !important;
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
      height: auto !important;
      width: auto !important;
      overflow: visible !important;
    }
    
    .vaga-horario {
      color: var(--primary) !important;
      font-weight: 600 !important;
    }
    
    .vaga-actions {
      display: flex !important;
      gap: 8px !important;
      justify-content: flex-end !important;
    }
    
    .vaga-actions .btn {
      font-size: 11px !important;
      padding: 6px 12px !important;
      white-space: nowrap !important;
    }
  </style>
</head>

<body>
  <!-- TELA DE LOGIN (inicialmente visÃ­vel) -->
  <div id="login-overlay" class="login-overlay">
    <div class="login-container">
      <div class="login-card">
        <div class="login-header">
          <div class="login-logo">ğŸ¢</div>
          <div class="login-title">MotoPro</div>
          <div class="login-subtitle">Sistema de GestÃ£o de Vagas</div>
        </div>
        
        <form id="loginForm" class="login-form">
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required placeholder="seu@email.com">
          </div>
          
          <div class="form-group">
            <label for="password">Senha</label>
            <input type="password" id="password" name="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
          </div>
          
          <button type="submit" id="loginBtn" class="login-btn">
            <span id="loginBtnText">ğŸ” Entrar</span>
          </button>
        </form>
        
        <div id="loginStatus" class="login-status"></div>
        
        <div class="login-credentials">
          <div>Credenciais de teste:</div>
          <div><strong>Email:</strong> lbulegon@gmail.com</div>
          <div><strong>Senha:</strong> Gabi#0201</div>
        </div>
      </div>
    </div>
  </div>

  <!-- APLICAÃ‡ÃƒO PRINCIPAL (inicialmente oculta) -->
  <div id="main-app" class="app" style="display: none;">
    <!-- Topbar -->
    <header class="topbar">
    <div class="store-badge">
      <div class="store-icon">ğŸ</div>
      <div>
        <div class="store-name">MotoPro Central</div>
        <div class="store-open">Aberto</div>
      </div>
    </div>
    <div class="kpis">
      <div class="kpi"><div class="kpi-label">Hoje</div><div class="kpi-value">125</div></div>
      <div class="kpi"><div class="kpi-label">MÃªs</div><div class="kpi-value">3.452</div></div>
    </div>
    <div class="top-right">
      <button class="icon-btn has-tip" data-tip="Ajuda">â“</button>
      <button class="icon-btn has-tip" data-tip="NotificaÃ§Ãµes">ğŸ””</button>
      <button class="icon-btn has-tip" data-tip="ConfiguraÃ§Ãµes">âš™ï¸</button>
      <div class="avatar has-tip" data-tip="Perfil">MP</div>
    </div>
  </header>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <button class="side-icon has-tip active" data-tip="Pedidos" id="btn-orders">ğŸ“¦</button>

      <button class="side-icon has-tip" data-tip="AlocaÃ§Ãµes" id="btn-alocacoes">ğŸ‘¥</button>
      <button class="side-icon has-tip" data-tip="Admin Vagas" id="btn-admin-vagas">ğŸ—“ï¸</button>
      <button class="side-icon has-tip" data-tip="Encerrar Vagas" id="btn-encerrar-vagas">ğŸ”š</button>
    </aside>

    <!-- ConteÃºdo em 2 colunas -->
    <main class="content">
      <!-- COLUNA ESQUERDA -->
      <section class="left">
        <!-- VIEW: Pedidos -->
        <div id="left-orders" class="left-view">
          <div class="auto-accept">
            <span>Aceite automÃ¡tico de pedidos</span>
            <button id="btnAuto" class="btn-auto off has-tip" data-tip="Aceite automÃ¡tico desativado">OFF</button>
          </div>

          <div class="search-row">
            <div class="search">
              <span class="search-ico">ğŸ”</span>
              <input id="search" type="text" placeholder="Buscar pedido" />
            </div>
            <button class="btn btn-outline has-tip" data-tip="Filtrar pedidos">Filtros</button>
          </div>

          <section class="section section--scroll section--pendentes">
            <div class="section-title">Pedidos Pendentes <span class="badge" id="count-pendentes">8</span></div>
            <div class="list" id="list-pendentes"></div>
          </section>

          <section class="section section--scroll section--entrega">
            <div class="section-title">Em entrega <span class="badge" id="count-entrega">2</span></div>
            <div class="list" id="list-entrega"></div>
          </section>
        </div>





        <!-- VIEW: AlocaÃ§Ãµes (motoboys alocados) -->
        <div id="left-alocacoes" class="left-view hidden">
          <h2 class="section-title">AlocaÃ§Ãµes Ativas</h2>
          <div class="list" id="alocacoes-container" style="padding:12px;"></div>
        </div>

        <!-- NOVA VIEW: Admin Vagas (calendÃ¡rio) -->
        <div id="left-admin-vagas" class="left-view hidden">
          <div class="auto-accept">
            <span>GestÃ£o de Vagas</span>
          </div>

          <!-- Interface Gerar Vagas Fixas -->
          <div class="search-row" style="margin-bottom: 16px; flex-direction: column; gap: 12px;">
            <div style="display: flex; gap: 8px; align-items: center;">
              <span style="font-weight: 600; color: #333;">ğŸ“‹ Gerar Vagas Fixas</span>
            </div>
            
            <div style="display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 12px; color: #666; min-width: 80px;">Data:</label>
              <input type="date" id="dataInicioVagas" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
            </div>
            
            <button id="btnGerarVagasFixas" class="btn btn-primary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;" onclick="gerarVagasFixas();">
              <span>ğŸš€</span>
              <span>Gerar Vagas para o Dia</span>
            </button>
          </div>

          <!-- Interface Gerar Vagas Extras -->
          <div class="search-row" style="margin-bottom: 16px; flex-direction: column; gap: 12px;">
            <div style="display: flex; gap: 8px; align-items: center;">
              <span style="font-weight: 600; color: #333;">â• Gerar Vagas Extras</span>
            </div>
            
            <div style="display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 12px; color: #666; min-width: 80px;">Data:</label>
              <input type="date" id="dataInicioVagasExtras" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
            </div>
            
            <div style="display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 12px; color: #666; min-width: 80px;">Quantidade:</label>
              <input type="number" id="quantidadeVagasExtras" min="1" max="50" value="1" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
            </div>
            
            <div style="display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 12px; color: #666; min-width: 80px;">Turno:</label>
              <select id="turnoVagasExtras" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                <option value="manha">ManhÃ£ (08:00-18:00)</option>
                <option value="noite">Noite (18:00-02:00)</option>
              </select>
            </div>
            
            <button id="btnGerarVagasExtras" class="btn btn-secondary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;" onclick="gerarVagasExtras();">
              <span>â•</span>
              <span>Gerar Vagas Extras</span>
            </button>
          </div>


        </div>

        <!-- NOVA VIEW: Encerrar Vagas -->
        <div id="left-encerrar-vagas" class="left-view hidden">
          <div class="auto-accept">
            <span>Encerrar Vagas por Turno</span>
          </div>

          <!-- Filtros de Data e Turno -->
          <div class="search-row" style="margin-bottom: 16px; flex-direction: column; gap: 12px;">
            <div style="display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 12px; color: #666; min-width: 60px;">Data:</label>
              <input type="date" id="dataEncerrar" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
            </div>
            
            <div style="display: flex; gap: 8px; align-items: center;">
              <label style="font-size: 12px; color: #666; min-width: 60px;">Turno:</label>
              <select id="turnoEncerrar" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                <option value="">Selecione o turno</option>
                <option value="manha">ManhÃ£ (08:00-18:00)</option>
                <option value="noite">Noite (18:00-02:00)</option>
                <option value="todos">Todos os turnos</option>
              </select>
            </div>
            
            <button id="btnBuscarVagasEncerrar" class="btn btn-primary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;" onclick="buscarVagasParaEncerrar();">
              <span>ğŸ”</span>
              <span>Buscar Vagas</span>
            </button>
          </div>

          <!-- Lista de Vagas para Encerrar -->
          <div id="vagasEncerrarContainer" style="display: none;">
            <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
              <span style="font-weight: 600; color: #333;">Vagas Encontradas</span>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input type="checkbox" id="selectAllVagas" onchange="toggleSelectAllVagas();">
                <label for="selectAllVagas" style="font-size: 12px; color: #666;">Selecionar Todas</label>
              </div>
            </div>
            
            <div id="listaVagasEncerrar" style="max-height: 400px; overflow-y: auto;"></div>
            
            <button id="btnEncerrarVagas" class="btn btn-danger" style="width: 100%; margin-top: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;" onclick="encerrarVagasSelecionadas();">
              <span>ğŸ”š</span>
              <span>Encerrar Vagas Selecionadas</span>
            </button>
          </div>
        </div>
      </section>

      <!-- COLUNA DIREITA -->
      <section class="right">
        <div class="detail empty" id="detail">Selecione um item para ver detalhes</div>
      </section>
    </main>
  </div> <!-- Fechamento da div main-app -->

  <!-- Scripts de configuraÃ§Ã£o -->
  <script src="config.js"></script>
  <!-- <script src="autoaceite.js"></script> -->

  <!-- Sistema de autenticaÃ§Ã£o global -->
  <script src="authManager.js"></script>

  <!-- Carrega o mÃ³dulo de integraÃ§Ã£o de vagas ANTES dos outros scripts -->
  <script src="vagasIntegration.js"></script>

  <!-- Sistema de login da aplicaÃ§Ã£o -->
  <script>
    // ====== ATALHO PARA ABRIR DEVTOOLS ======
    document.addEventListener('keydown', function(e) {
      if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
        if (typeof require !== 'undefined') {
          const { remote } = require('electron');
          if (remote && remote.getCurrentWindow) {
            remote.getCurrentWindow().webContents.openDevTools();
          }
        }
      }
    });
    
    // ====== SISTEMA DE LOGIN DA APLICAÃ‡ÃƒO ======
    class AppLoginManager {
      constructor() {
        this.loginOverlay = document.getElementById('login-overlay');
        this.mainApp = document.getElementById('main-app');
        this.loginForm = document.getElementById('loginForm');
        this.emailInput = document.getElementById('email');
        this.passwordInput = document.getElementById('password');
        this.loginBtn = document.getElementById('loginBtn');
        this.loginBtnText = document.getElementById('loginBtnText');
        this.loginStatus = document.getElementById('loginStatus');
        
        this.init();
      }
      
      init() {
        // Preencher credenciais de teste
        if (this.emailInput && this.passwordInput) {
          this.emailInput.value = 'lbulegon@gmail.com';
          this.passwordInput.value = 'Gabi#0201';
        }
        
        // Vincular eventos
        if (this.loginForm) {
          this.loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleLogin();
          });
        }
        
        // Verificar se jÃ¡ estÃ¡ autenticado
        this.checkAuthStatus();
      }
      
      async checkAuthStatus() {
        // Aguardar um pouco para garantir que o AuthManager foi carregado
        setTimeout(() => {
          if (window.authManager && window.authManager.isAuthenticated) {
            console.log('âœ… UsuÃ¡rio jÃ¡ autenticado, mostrando aplicaÃ§Ã£o...');
            this.showApp();
          } else {
            console.log('ğŸ” UsuÃ¡rio nÃ£o autenticado, mostrando tela de login...');
            this.showLogin();
          }
        }, 500);
      }
      
      async handleLogin() {
        if (!this.emailInput || !this.passwordInput || !this.loginBtn || !this.loginStatus) return;
        
        const email = this.emailInput.value.trim();
        const password = this.passwordInput.value;
        
        if (!email || !password) {
          this.showStatus('Por favor, preencha todos os campos', 'error');
          return;
        }
        
        // Desabilitar botÃ£o e mostrar loading
        this.loginBtn.disabled = true;
        this.loginBtnText.textContent = 'â³ Entrando...';
        this.showStatus('', '');
        
        try {
          console.log('ğŸ” Tentando login com:', email);
          
          // Usar o AuthManager para fazer login
          const result = await window.authManager.login(email, password);
          
          if (result.success) {
            this.showStatus('âœ… Login realizado com sucesso!', 'success');
            
            // Aguardar um pouco para mostrar a mensagem de sucesso
            setTimeout(() => {
              this.showApp();
            }, 1000);
          } else {
            this.showStatus('âŒ Falha no login', 'error');
          }
        } catch (error) {
          console.error('âŒ Erro no login:', error);
          this.showStatus(`âŒ Erro: ${error.message}`, 'error');
        } finally {
          // Reabilitar botÃ£o
          this.loginBtn.disabled = false;
          this.loginBtnText.textContent = 'ğŸ” Entrar';
        }
      }
      
      showStatus(message, type) {
        if (!this.loginStatus) return;
        
        if (!message) {
          this.loginStatus.style.display = 'none';
          this.loginStatus.className = 'login-status';
          return;
        }
        
        this.loginStatus.style.display = 'block';
        this.loginStatus.textContent = message;
        this.loginStatus.className = `login-status ${type}`;
      }
      
      showLogin() {
        if (this.loginOverlay) this.loginOverlay.style.display = 'flex';
        if (this.mainApp) this.mainApp.style.display = 'none';
      }
      
      showApp() {
        if (this.loginOverlay) this.loginOverlay.style.display = 'none';
        if (this.mainApp) this.mainApp.style.display = 'block';
        
        // Inicializar a aplicaÃ§Ã£o
        this.initApp();
      }
      
      initApp() {
        console.log('ğŸš€ Inicializando aplicaÃ§Ã£o...');
        
        // Renderizar listas iniciais
        if (typeof renderOrdersLists === 'function') {
          renderOrdersLists();
        }
        
        // Inicializar integraÃ§Ã£o de vagas
        if (window.vagasIntegration && typeof window.vagasIntegration.init === 'function') {
          window.vagasIntegration.init();
        }
        
        console.log('âœ… AplicaÃ§Ã£o inicializada');
      }
    }
    
    // Inicializar o sistema de login quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', () => {
      new AppLoginManager();
    });
  </script>

  <script>
    // --------- Dados de exemplo de entregadores ---------
    const ridersData = [
      { id: 11, nome: "JoÃ£o Silva",  foto: "", status: "Ativo",   entregasTurno: 5, placa: "ABC-1234", telefone: "(11) 99999-1111", rating: 4.8 },
      { id: 22, nome: "Maria Santos",foto: "", status: "Ocupado", entregasTurno: 3, placa: "XYZ-5678", telefone: "(11) 98888-2222", rating: 4.6 },
      { id: 33, nome: "Pedro Lima",  foto: "", status: "Inativo", entregasTurno: 0, placa: "MTP-2025", telefone: "(11) 97777-3333", rating: 4.1 },
      { id: 44, nome: "Carla Souza", foto: "https://randomuser.me/api/portraits/women/65.jpg", status: "Ativo", entregasTurno: 7, placa: "JKL-0001", telefone: "(11) 96666-4444", rating: 4.9 },
    ];

    // --------- Utils: iniciais + cor fixa por nome ---------
    function initials(name){ return (name||"").split(/\s+/).slice(0,2).map(p=>p[0]).join("").toUpperCase(); }
    function colorFrom(name){
      const colors=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#14b8a6","#f97316","#06b6d4"];
      let sum=0; for(const c of name) sum=(sum+c.charCodeAt(0))%997; return colors[sum%colors.length];
    }

    // --------- Render lista de entregadores (cards) ---------
    function renderRidersList(){
      const list=document.getElementById("riders-list");
      list.innerHTML=ridersData.map(r=>{
        const hasPhoto=!!r.foto;
        const avatar=hasPhoto
          ? `<img src="${r.foto}" alt="${r.nome}" style="width:60px;height:60px;border-radius:50%;object-fit:cover;">`
          : `<div class="avatar-circle" style="background:${colorFrom(r.nome)}">${initials(r.nome)}</div>`;
        const statusClass=r.status==="Ativo"?"badge-online":(r.status==="Ocupado"?"chip":"badge-offline");
        return `
          <div class="rider-card has-tip" data-tip="Ver detalhes" data-id="${r.id}" style="cursor:pointer">
            ${avatar}
            <div class="rider-info" style="flex:1">
              <h3 style="margin:0;font-size:15px">${r.nome}</h3>
              <div class="rider-meta">Placa ${r.placa} â€¢ Entregas no turno: <strong>${r.entregasTurno}</strong></div>
            </div>
            <div class="${statusClass}">${r.status}</div>
          </div>`;
      }).join("");

      list.querySelectorAll(".rider-card").forEach(card=>{
        card.addEventListener("click",()=>{
          const id=Number(card.getAttribute("data-id"));
          const rider=ridersData.find(r=>r.id===id);
          if(rider) renderRiderDetail(rider);
        });
      });
    }

    // --------- Render detalhes (motoboy) ---------
    function renderRiderDetail(r){
      const box=document.getElementById("detail");
      box.classList.remove("empty");
      const hasPhoto=!!r.foto;
      const hero=hasPhoto?`<img src="${r.foto}" alt="${r.nome}">`:`<div class="rider-hero" style="background:${colorFrom(r.nome)}">${initials(r.nome)}</div>`;
      box.innerHTML=`
        <div class="rider-header">
          ${hasPhoto?`<div class="rider-hero">${hero}</div>`:hero}
          <div class="rider-title">
            <div class="rider-name">${r.nome}</div>
            <div class="rider-badges">
              <span class="${r.status==='Ativo'?'badge-online':(r.status==='Ocupado'?'chip':'badge-offline')}">${r.status}</span>
              <span class="badge-ghost">Placa: ${r.placa}</span>
              <span class="badge-ghost">Tel: ${r.telefone}</span>
            </div>
          </div>
        </div>
        <div class="actions-bar">
          <button class="btn-outline">Abrir no painel web</button>
          <button class="btn-primary">Chamar para entrega</button>
          <button class="btn btn-soft">Enviar mensagem</button>
        </div>
        <div class="detail-section">
          <div class="stat-grid">
            <div class="stat"><div class="k">Entregas (turno)</div><div class="v">${r.entregasTurno}</div></div>
            <div class="stat"><div class="k">AvaliaÃ§Ã£o</div><div class="v">â­ ${r.rating.toFixed(1)}</div></div>
            <div class="stat"><div class="k">Pontualidade</div><div class="v">96%</div></div>
            <div class="stat"><div class="k">Taxa aceite</div><div class="v">88%</div></div>
          </div>
          <div class="info-cards">
            <div class="info-card">
              <div class="label">Documento</div><div class="value">***.***.***-**</div>
              <div class="label" style="margin-top:6px">CNH</div><div class="value">AB â€¢ VÃ¡lida</div>
            </div>
            <div class="info-card">
              <div class="label">VeÃ­culo</div><div class="value">Moto â€¢ ${r.placa}</div>
              <div class="label" style="margin-top:6px">Seguro</div><div class="value">OK</div>
            </div>
          </div>
          <div class="timeline">
            <div style="font-weight:800; margin-bottom:6px;">Ãšltimos eventos</div>
            <div class="item"><div class="dot"></div><div><div>Finalizou entrega #4321</div><div class="when">hÃ¡ 6 min</div></div></div>
            <div class="item"><div class="dot"></div><div><div>Retirou pedido #4321</div><div class="when">hÃ¡ 18 min</div></div></div>
            <div class="item"><div class="dot"></div><div><div>Entrou no turno</div><div class="when">hÃ¡ 1h 02min</div></div></div>
          </div>
          <div class="footer-actions" style="justify-content:flex-end">
            <button class="btn-danger">Bloquear</button>
            <button class="btn-outline">Remover do turno</button>
          </div>
        </div>`;
    }

    // ========= DADOS EXEMPLO =========
    const ordersDataPendentes = [
      { id:1001, cliente:"Maria Silva",  status:"Em preparo", prazo:"12:30", pagamento:"PIX",     taxaEntrega:7.90, subtotal:52.00, desconto:5.00,
        endereco:"Rua das Flores, 123 â€¢ Bela Vista", obs:"Sem cebola",
        itens:[ {nome:"Burger ClÃ¡ssico",qtd:1,preco:28.00}, {nome:"Batata mÃ©dia",qtd:1,preco:12.00}, {nome:"Refrigerante",qtd:1,preco:12.00} ] },
      { id:1002, cliente:"JoÃ£o Pereira", status:"Em preparo", prazo:"12:34", pagamento:"CrÃ©dito", taxaEntrega:6.90, subtotal:39.90, desconto:0.00,
        endereco:"Av. Paulista, 555 â€¢ ConsolaÃ§Ã£o", obs:"",
        itens:[ {nome:"Wrap Frango",qtd:1,preco:22.90}, {nome:"Suco Laranja",qtd:1,preco:17.00} ] },
    ];
    const ordersDataEntrega = [
      { id:999, cliente:"Carlos Lima",  status:"A caminho", prazo:"13:05", pagamento:"Dinheiro", taxaEntrega:8.50, subtotal:61.00, desconto:0.00,
        endereco:"R. Itapura, 77 â€¢ Moema", obs:"Troco para 100", itens:[ {nome:"Combo FamÃ­lia",qtd:1,preco:61.00} ] },
      { id:998, cliente:"Beatriz Costa",status:"A caminho", prazo:"13:12", pagamento:"DÃ©bito",  taxaEntrega:7.50, subtotal:42.00, desconto:2.00,
        endereco:"R. Vergueiro, 2210 â€¢ Vila Mariana", obs:"", itens:[ {nome:"Salada Caesar",qtd:1,preco:24.00}, {nome:"Ãgua 500ml",qtd:2,preco:9.00}, {nome:"Molho extra",qtd:1,preco:9.00} ] },
    ];
    const vagasData = [
      { id:1, titulo:"Turno AlmoÃ§o", janela:"11:00â€“15:00", capacidade:6, ocupadas:4, local:"Zona Sul",  requisitos:["CNH A vÃ¡lida","Moto prÃ³pria","Seguro OK"] },
      { id:2, titulo:"Turno Jantar", janela:"18:00â€“22:00", capacidade:8, ocupadas:7, local:"Zona Leste", requisitos:["CNH A vÃ¡lida","ExperiÃªncia > 6 meses"] },
    ];

    // ========= HELPERS =========
    function money(v){ return v.toLocaleString("pt-BR",{style:"currency", currency:"BRL"}); }

    // ========= RENDER LISTAS =========
    function renderOrdersLists(){
      const pend=document.getElementById("list-pendentes");
      const entr=document.getElementById("list-entrega");
      const b1=document.getElementById("count-pendentes");
      const b2=document.getElementById("count-entrega");
      b1.textContent=ordersDataPendentes.length;
      b2.textContent=ordersDataEntrega.length;

      pend.innerHTML=ordersDataPendentes.map(o=>`
        <div class="card order-card" data-oid="${o.id}" style="cursor:pointer">
          <div class="row-top"><span class="order-id">#${o.id}</span><span class="order-name">${o.cliente}</span></div>
          <div class="badge-status badge-preparo"><span class="dot"></span> ${o.status}</div>
        </div>`).join("");

      entr.innerHTML=ordersDataEntrega.map(o=>`
        <div class="card order-card" data-oid="${o.id}" style="cursor:pointer">
          <div class="row-top"><span class="order-id">#${o.id}</span><span class="order-name">${o.cliente}</span></div>
          <div class="badge-status badge-entrega"><span class="dot"></span> ${o.status}</div>
        </div>`).join("");

      document.querySelectorAll(".order-card").forEach(el=>{
        el.addEventListener("click",()=>{
          const id=Number(el.getAttribute("data-oid"));
          const o=ordersDataPendentes.find(x=>x.id===id)||ordersDataEntrega.find(x=>x.id===id);
          if(o) renderOrderDetail(o);
        });
      });
    }



    // ========= DETALHES (lado direito) =========
    function renderOrderDetail(o){
      const box=document.getElementById("detail");
      box.classList.remove("empty");
      const total=o.subtotal+o.taxaEntrega-(o.desconto||0);
      const badgeClass=(o.status==="A caminho")?"badge-entrega":"badge-preparo";
      box.innerHTML=`
        <div class="hdr">
          <div class="title"><strong>Pedido #${o.id}</strong> â€¢ ${o.cliente}</div>
          <div class="meta">
            <span class="pill"><strong>Status:</strong> ${o.status}</span>
            <span class="pill"><strong>Pagamento:</strong> ${o.pagamento}</span>
            <span class="pill"><strong>Prazo:</strong> ${o.prazo}</span>
          </div>
        </div>
        <div class="block">
          <div class="addr"><span>ğŸ“</span> <div>${o.endereco}</div></div>
          ${o.obs?`<div class="chips" style="margin-top:8px"><span class="chip">Obs: ${o.obs}</span></div>`:""}
        </div>
        <div class="block items">
          ${o.itens.map(it=>`<div class="item"><div>${it.qtd}Ã— ${it.nome}</div><div>${money(it.preco)}</div></div>`).join("")}
          <div class="item"><div>Subtotal</div><div>${money(o.subtotal)}</div></div>
          <div class="item"><div>Taxa de entrega</div><div>${money(o.taxaEntrega)}</div></div>
          ${o.desconto?`<div class="item"><div>Desconto</div><div>- ${money(o.desconto)}</div></div>`:""}
          <div class="item" style="font-weight:700;border-top:1px dashed #ddd"><div>Total</div><div class="price">${money(total)}</div></div>
        </div>
        <div class="footer-actions">
          <div class="badge-status ${badgeClass}"><span class="dot"></span> ${o.status}</div>
          <div style="flex:1"></div>
          <button class="btn-outline">Imprimir</button>
          <button class="btn-primary">Atribuir entregador</button>
        </div>`;
    }

    function renderVagaDetail(v){
      // Usar a funÃ§Ã£o de detalhes da integraÃ§Ã£o se disponÃ­vel
      if (typeof window.viewVagaDetails === 'function') {
        window.viewVagaDetails(v.id);
      } else {
        // Fallback para o formato antigo
        const box=document.getElementById("detail");
        box.classList.remove("empty");
        const restante=Math.max(v.capacidade - v.ocupadas,0);
        const livreTxt=restante>0?`${restante} vagas abertas`:"Lotado";
        box.innerHTML=`
          <div class="hdr">
            <div class="title"><strong>${v.titulo}</strong> â€¢ ${v.janela}</div>
            <div class="meta">
              <span class="pill"><strong>Local:</strong> ${v.local}</span>
              <span class="pill"><strong>Capacidade:</strong> ${v.capacidade}</span>
              <span class="pill"><strong>Ocupadas:</strong> ${v.ocupadas}</span>
              <span class="pill"><strong>Status:</strong> ${livreTxt}</span>
            </div>
          </div>
          <div class="block">
            <div style="font-weight:700;margin-bottom:8px">Requisitos</div>
            <div class="chips">${v.requisitos.map(r=>`<span class="chip">${r}</span>`).join("")}</div>
          </div>
          <div class="block">
            <div style="font-weight:700;margin-bottom:8px">Candidatos recentes</div>
            <div class="rider-card">
              <div class="thumb" style="display:flex;align-items:center;justify-content:center">ğŸ‘¤</div>
              <div style="flex:1;margin-left:10px"><div class="rider-id">Felipe Andrade</div><div class="rider-meta">CNH A â€¢ Moto OK â€¢ Nota 4.7</div></div>
              <button class="btn-outline">Ver perfil</button>
            </div>
            <div class="rider-card" style="margin-top:8px">
              <div class="thumb" style="display:flex;align-items:center;justify-content:center">ğŸ‘¤</div>
              <div style="flex:1;margin-left:10px"><div class="rider-id">Aline Sousa</div><div class="rider-meta">CNH A â€¢ ExperiÃªncia 1 ano â€¢ Nota 4.5</div></div>
              <button class="btn-outline">Ver perfil</button>
            </div>
          </div>
          <div class="footer-actions">
            <button class="btn-danger">Encerrar vaga</button>
            <button class="btn-primary">Adicionar entregador</button>
          </div>`;
      }
    }

    // ========= INICIALIZAÃ‡ÃƒO =========
    document.addEventListener("DOMContentLoaded",()=>{
      renderOrdersLists();
    });
  </script>

  <!-- Carrega o mÃ³dulo Admin Vagas de arquivo externo -->
  <script src="adminvagas.js"></script>
  
  <!-- Carrega o mÃ³dulo de AlocaÃ§Ãµes de arquivo externo -->
  <script src="alocacoesIntegration.js"></script>

  <!-- FunÃ§Ã£o Global para Gerar Vagas Fixas -->
  <script>
    // FunÃ§Ã£o global para gerar vagas fixas
    async function gerarVagasFixas() {
      console.log('ğŸš€ FunÃ§Ã£o gerarVagasFixas chamada!');
      
      const dataInicioInput = document.getElementById("dataInicioVagas");
      if (!dataInicioInput) {
        alert('âŒ Campo de data nÃ£o encontrado!');
        return;
      }

      const dataInicio = dataInicioInput.value;
      if (!dataInicio) {
        alert('âŒ Por favor, selecione uma data!');
        dataInicioInput.focus();
        return;
      }

      // Confirmar aÃ§Ã£o
      const confirmar = confirm(`ğŸ“‹ Deseja gerar vagas fixas para o dia ${dataInicio}?`);
      if (!confirmar) {
        return;
      }

      try {
        // Verificar se estÃ¡ autenticado
        if (!window.authManager || !window.authManager.isAuthenticated) {
          alert('âŒ UsuÃ¡rio nÃ£o autenticado - faÃ§a login primeiro');
          return;
        }

        // Usar estabelecimento ID fixo (pode ser configurado via variÃ¡vel de ambiente)
        const estabelecimentoId = "11"; // Valor padrÃ£o, pode ser alterado

        // Preparar payload
        const payload = {
          estabelecimento_id: parseInt(estabelecimentoId),
          data_inicio: dataInicio,
          dias: 1
        };

        console.log('ğŸ“‹ Enviando payload:', payload);

        // Chamar o endpoint
        const response = await window.authManager.authenticatedRequest('/motoboy-vaga/gerar-vagas-fixas/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          const result = await response.json();
          console.log('âœ… Resposta da API:', result);
          console.log('ğŸ“‹ Status da resposta:', response.status);
          console.log('ğŸ“‹ Headers da resposta:', response.headers);
          
          // Determinar quantas vagas foram criadas - lÃ³gica melhorada
          let totalVagas = 0;
          let vagasCriadas = [];
          
          // Verificar diferentes possÃ­veis estruturas da resposta
          if (result.vagas_criadas && Array.isArray(result.vagas_criadas)) {
            totalVagas = result.vagas_criadas.length;
            vagasCriadas = result.vagas_criadas;
          } else if (result.vagas_criadas_total !== undefined) {
            totalVagas = result.vagas_criadas_total;
          } else if (result.total_vagas_criadas !== undefined) {
            totalVagas = result.total_vagas_criadas;
          } else if (result.vagas && Array.isArray(result.vagas)) {
            totalVagas = result.vagas.length;
            vagasCriadas = result.vagas;
          } else if (result.count !== undefined) {
            totalVagas = result.count;
          } else if (result.mensagem && result.mensagem.includes('sucesso')) {
            // Se a mensagem indica sucesso, assumir que vagas foram criadas
            totalVagas = 1;
          } else if (result.message && result.message.includes('criada')) {
            // Se a mensagem indica que vagas foram criadas
            totalVagas = 1;
          } else if (result.success === true || result.status === 'success') {
            // Se a resposta indica sucesso, assumir que vagas foram criadas
            totalVagas = 1;
          }
          
          console.log('ğŸ“‹ Total de vagas detectadas:', totalVagas);
          console.log('ğŸ“‹ Estrutura do resultado:', Object.keys(result));
          console.log('ğŸ“‹ Mensagem da API:', result.message || 'N/A');
          console.log('ğŸ“‹ Status da API:', result.status || result.success || 'N/A');
          
          if (totalVagas > 0 || result.success === true || result.status === 'success' || (result.message && result.message.toLowerCase().includes('criada'))) {
            let mensagem = `ğŸ‰ Sucesso! Vagas criadas para ${dataInicio}`;
            
            if (totalVagas > 0) {
              mensagem = `ğŸ‰ Sucesso! ${totalVagas} vagas criadas para ${dataInicio}`;
            }
            
            // Adicionar detalhes das vagas se disponÃ­vel
            if (vagasCriadas.length > 0) {
              mensagem += '\n\nVagas criadas:';
              vagasCriadas.forEach((vaga, index) => {
                mensagem += `\n${index + 1}. ID: ${vaga.id || 'N/A'} | Status: ${vaga.status || 'N/A'}`;
              });
            }
            
            // Adicionar mensagem da API se disponÃ­vel
            if (result.mensagem) {
              mensagem += `\n\nğŸ“‹ ${result.mensagem}`;
            } else if (result.message) {
              mensagem += `\n\nğŸ“‹ ${result.message}`;
            }
            
            // Adicionar detalhes dos estabelecimentos se disponÃ­vel
            if (result.estabelecimentos_processados && Array.isArray(result.estabelecimentos_processados)) {
              mensagem += `\n\nğŸ¢ Estabelecimentos processados:`;
              result.estabelecimentos_processados.forEach((est, index) => {
                mensagem += `\n${index + 1}. ${est.estabelecimento} - ${est.vagas_criadas} vagas criadas`;
              });
            }
            
            alert(mensagem);
          } else {
            let mensagem = `âš ï¸ Nenhuma vaga foi criada para ${dataInicio}\n\n`;
            mensagem += `ğŸ“‹ Resposta da API:\n${JSON.stringify(result, null, 2)}\n\n`;
            mensagem += `â“ PossÃ­veis motivos:\n`;
            mensagem += `â€¢ Vagas jÃ¡ existem para esta data\n`;
            mensagem += `â€¢ Estabelecimento nÃ£o configurado\n`;
            mensagem += `â€¢ ConfiguraÃ§Ã£o invÃ¡lida\n`;
            mensagem += `â€¢ Problemas na API`;
            
            alert(mensagem);
          }
          
        } else {
          const errorText = await response.text();
          console.error('âŒ Erro da API:', errorText);
          alert(`âŒ Erro ao gerar vagas:\n\n${errorText}`);
        }

      } catch (error) {
        console.error('âŒ Erro:', error);
        alert(`âŒ Erro: ${error.message}`);
      }
    }

    // FunÃ§Ã£o global para gerar vagas extras
    async function gerarVagasExtras() {
      console.log('â• FunÃ§Ã£o gerarVagasExtras chamada!');
      
      const dataInicioInput = document.getElementById("dataInicioVagasExtras");
      const quantidadeInput = document.getElementById("quantidadeVagasExtras");
      const turnoSelect = document.getElementById("turnoVagasExtras");
      
      if (!dataInicioInput || !quantidadeInput || !turnoSelect) {
        alert('âŒ Campos nÃ£o encontrados!');
        return;
      }

      const dataInicio = dataInicioInput.value;
      const quantidade = parseInt(quantidadeInput.value);
      const turno = turnoSelect.value;

      if (!dataInicio) {
        alert('âŒ Por favor, selecione uma data!');
        dataInicioInput.focus();
        return;
      }

      if (!quantidade || quantidade < 1 || quantidade > 50) {
        alert('âŒ Por favor, insira uma quantidade vÃ¡lida (1-50)!');
        quantidadeInput.focus();
        return;
      }

      if (!turno) {
        alert('âŒ Por favor, selecione um turno!');
        turnoSelect.focus();
        return;
      }

      // Confirmar aÃ§Ã£o
      const turnoText = turno === 'manha' ? 'ManhÃ£ (08:00-18:00)' : 'Noite (18:00-02:00)';
      const confirmar = confirm(`â• Deseja gerar ${quantidade} vaga(s) extra(s) para o dia ${dataInicio} no turno ${turnoText}?`);
      if (!confirmar) {
        return;
      }

      try {
        // Verificar se estÃ¡ autenticado
        if (!window.authManager || !window.authManager.isAuthenticated) {
          alert('âŒ UsuÃ¡rio nÃ£o autenticado - faÃ§a login primeiro');
          return;
        }

        // Usar estabelecimento ID fixo (pode ser configurado via variÃ¡vel de ambiente)
        const estabelecimentoId = "11"; // Valor padrÃ£o, pode ser alterado

        // Preparar payload
        const payload = {
          estabelecimento_id: parseInt(estabelecimentoId),
          data_inicio: dataInicio,
          quantidade: quantidade,
          turno: turno,
          tipo_vaga: 'extra'
        };

        console.log('â• Enviando payload:', payload);

        // Chamar o endpoint
        const response = await window.authManager.authenticatedRequest('/desktop/gerar-vagas-extras/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          const result = await response.json();
          console.log('âœ… Resposta da API:', result);
          
          // Determinar quantas vagas foram criadas
          let totalVagas = 0;
          let vagasCriadas = [];
          
          // Verificar diferentes possÃ­veis estruturas da resposta
          if (result.vagas_criadas && Array.isArray(result.vagas_criadas)) {
            totalVagas = result.vagas_criadas.length;
            vagasCriadas = result.vagas_criadas;
          } else if (result.vagas_criadas_total !== undefined) {
            totalVagas = result.vagas_criadas_total;
          } else if (result.total_vagas_criadas !== undefined) {
            totalVagas = result.total_vagas_criadas;
          } else if (result.vagas && Array.isArray(result.vagas)) {
            totalVagas = result.vagas.length;
            vagasCriadas = result.vagas;
          } else if (result.count !== undefined) {
            totalVagas = result.count;
          } else if (result.success === true || result.status === 'success') {
            totalVagas = quantidade; // Assumir que todas as vagas foram criadas
          }
          
          if (totalVagas > 0 || result.success === true || result.status === 'success') {
            let mensagem = `ğŸ‰ Sucesso! ${totalVagas} vaga(s) extra(s) criada(s) para ${dataInicio} no turno ${turnoText}`;
            
            // Adicionar detalhes das vagas se disponÃ­vel
            if (vagasCriadas.length > 0) {
              mensagem += '\n\nVagas criadas:';
              vagasCriadas.forEach((vaga, index) => {
                mensagem += `\n${index + 1}. ID: ${vaga.id || 'N/A'} | Status: ${vaga.status || 'N/A'}`;
              });
            }
            
            // Adicionar mensagem da API se disponÃ­vel
            if (result.mensagem) {
              mensagem += `\n\nğŸ“‹ ${result.mensagem}`;
            } else if (result.message) {
              mensagem += `\n\nğŸ“‹ ${result.message}`;
            }
            
            alert(mensagem);
          } else {
            let mensagem = `âš ï¸ Nenhuma vaga extra foi criada para ${dataInicio}\n\n`;
            mensagem += `ğŸ“‹ Resposta da API:\n${JSON.stringify(result, null, 2)}\n\n`;
            mensagem += `â“ PossÃ­veis motivos:\n`;
            mensagem += `â€¢ Estabelecimento nÃ£o configurado\n`;
            mensagem += `â€¢ ConfiguraÃ§Ã£o invÃ¡lida\n`;
            mensagem += `â€¢ Problemas na API`;
            
            alert(mensagem);
          }
          
        } else {
          const errorText = await response.text();
          console.error('âŒ Erro da API:', errorText);
          alert(`âŒ Erro ao gerar vagas extras:\n\n${errorText}`);
        }

      } catch (error) {
        console.error('âŒ Erro:', error);
        alert(`âŒ Erro: ${error.message}`);
      }
    }
    
    // FunÃ§Ã£o para carregar lista de vagas
    async function carregarListaVagas() {
      console.log('ğŸš€ FunÃ§Ã£o carregarListaVagas chamada!');
      const detailElement = document.getElementById("detail");
      console.log('ğŸ¯ Elemento detail encontrado:', detailElement);
      if (!detailElement) {
        console.error('âŒ Elemento detail nÃ£o encontrado');
        return;
      }
      
      try {
        // Verificar se estÃ¡ autenticado
        if (!window.authManager || !window.authManager.isAuthenticated) {
          detailElement.innerHTML = `
            <div class="empty">
              <div style="text-align: center; padding: 20px;">
                <div style="font-size: 24px; margin-bottom: 10px;">ğŸ”</div>
                <div>FaÃ§a login para visualizar as vagas</div>
              </div>
            </div>
          `;
          return;
        }
        
                // Interface de carregamento simples
        detailElement.innerHTML = `
          <div class="hdr" style="padding: 16px; border-bottom: 1px solid #dee2e6;">
            <div class="title"><strong>ğŸ“‹ Lista de Vagas</strong></div>
          </div>
          
          <div id="vagasLista" style="text-align: center; padding: 20px;">
            <div style="font-size: 24px; margin-bottom: 10px;">â³</div>
            <div>Carregando vagas...</div>
          </div>
        `;
        
        console.log('ğŸ¨ Interface de carregamento criada, elemento vagasLista:', document.getElementById("vagasLista"));
        
        // Buscar vagas da API (sem filtros)
        console.log('ğŸ” Buscando vagas da API...');
        
        // Usar a funÃ§Ã£o de integraÃ§Ã£o simples
        if (typeof window.renderVagasInSidebar === 'function') {
            await window.renderVagasInSidebar();
            return;
        }
        
        // Fallback: usar requisiÃ§Ã£o direta
        const response = await window.authManager.authenticatedRequest('/desktop/vagas/', {
          method: 'GET'
        });
        console.log('ğŸ“¡ Resposta da API:', response);
        console.log('ğŸ“¡ Status da resposta:', response.status);
        
        if (response.ok) {
          const vagas = await response.json();
          console.log('ğŸ“‹ Vagas carregadas:', vagas);
          console.log('ğŸ“‹ Tipo de vagas:', typeof vagas);
          console.log('ğŸ“‹ Ã‰ array?', Array.isArray(vagas));
          console.log('ğŸ“‹ Primeira vaga:', vagas && vagas.length > 0 ? vagas[0] : 'Nenhuma vaga');
          
          // Renderizar lista de vagas diretamente
          console.log('ğŸ¯ Chamando renderizarListaVagas com', vagas.length, 'vagas');
          renderizarListaVagas(vagas);
          
        } else {
          const errorText = await response.text();
          console.error('âŒ Erro ao carregar vagas:', errorText);
          document.getElementById("vagasLista").innerHTML = `
            <div style="text-align: center; padding: 20px; color: #e74c3c;">
              <div style="font-size: 24px; margin-bottom: 10px;">âŒ</div>
              <div>Erro ao carregar vagas</div>
              <div style="font-size: 12px; margin-top: 10px;">${errorText}</div>
            </div>
          `;
        }
        
      } catch (error) {
        console.error('âŒ Erro ao carregar vagas:', error);
        document.getElementById("vagasLista").innerHTML = `
          <div style="text-align: center; padding: 20px; color: #e74c3c;">
            <div style="font-size: 24px; margin-bottom: 10px;">âŒ</div>
            <div>Erro ao carregar vagas</div>
            <div style="font-size: 12px; margin-top: 10px;">${error.message}</div>
          </div>
        `;
      }
    }
    
    // FunÃ§Ã£o para renderizar lista de vagas
    function renderizarListaVagas(vagas) {
      const vagasListaElement = document.getElementById("vagasLista");
      if (!vagasListaElement) {
        console.error('âŒ Elemento vagasLista nÃ£o encontrado');
        return;
      }
      
      if (!vagas || vagas.length === 0) {
        vagasListaElement.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #7f8c8d;">
            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“­</div>
            <div>Nenhuma vaga encontrada</div>
          </div>
        `;
        return;
      }
      
      // Debug: mostrar todas as vagas recebidas
      console.log('ğŸ” Total de vagas recebidas:', vagas.length);
      vagas.forEach((vaga, index) => {
        console.log(`ğŸ“‹ Vaga ${index + 1}: ID ${vaga.id}, Data Original: ${vaga.data_da_vaga}, Data Formatada: ${vaga.data_da_vaga.split('-').reverse().join('/')}, Status: ${vaga.status}`);
      });
      
      // Ordenar vagas por data (mais recentes primeiro)
      vagas.sort((a, b) => new Date(b.data_da_vaga) - new Date(a.data_da_vaga));
      
      console.log('ğŸ“Š Vagas apÃ³s ordenaÃ§Ã£o:');
      vagas.forEach((vaga, index) => {
        console.log(`ğŸ“‹ Vaga ${index + 1}: ID ${vaga.id}, Data: ${vaga.data_da_vaga}`);
      });
      
      let html = `
        <!-- Container principal com cabeÃ§alho fixo -->
        <div style="
          border: 1px solid #e2e8f0;
          border-radius: 8px;
          overflow: hidden;
          height: 100%;
          display: flex;
          flex-direction: column;
        ">
          <!-- CabeÃ§alho fixo -->
          <div style="
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            font-weight: 600;
            color: #374151;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
          ">
            <div style="flex: 0 0 80px;">ID</div>
            <div style="flex: 0 0 120px;">Status</div>
            <div style="flex: 1;">Estabelecimento</div>
            <div style="flex: 0 0 100px;">HorÃ¡rio</div>
            <div style="flex: 0 0 100px;">Data</div>
            <div style="flex: 0 0 80px; text-align: right;">AÃ§Ã£o</div>
          </div>
          
          <!-- Ãrea de rolagem das vagas -->
          <div style="
            flex: 1;
            overflow-y: auto;
            background: white;
          ">
      `;
      
      vagas.forEach(vaga => {
        const statusColor = vaga.status === 'aberta' ? '#22c55e' : '#ef4444';
        const statusBg = vaga.status === 'aberta' ? '#dcfce7' : '#fee2e2';
        
        html += `
          <div style="
            border: 1px solid #e5e7eb; 
            margin: 8px 0; 
            background: #ffffff; 
            border-radius: 8px; 
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
          ">
            <!-- Card Body com tudo em uma linha -->
            <div style="
              padding: 16px 20px;
              display: flex;
              align-items: center;
              gap: 16px;
              background: white;
              border-bottom: 1px solid #f1f5f9;
            ">
              <!-- ID da Vaga -->
              <div style="flex: 0 0 80px;">
                <div style="
                  font-size: 14px;
                  font-weight: 700;
                  color: #1f2937;
                  display: flex;
                  align-items: center;
                  gap: 6px;
                ">
                  <span>#${vaga.id}</span>
                  <div style="
                    width: 6px;
                    height: 6px;
                    background: ${statusColor};
                    border-radius: 50%;
                  "></div>
                </div>
              </div>
            
              <!-- Status -->
              <div style="flex: 0 0 120px;">
                <div style="
                  background: ${statusBg};
                  color: ${statusColor};
                  padding: 4px 12px;
                  border-radius: 20px;
                  font-size: 11px;
                  font-weight: 600;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  display: inline-block;
                  text-align: center;
                ">${vaga.status}</div>
              </div>
              <div style="flex: 1;">
                <div style="
                  font-size: 14px;
                  font-weight: 600;
                  color: #111827;
                  line-height: 1.2;
                ">${vaga.estabelecimento_nome}</div>
              </div>
            
              <div style="flex: 0 0 100px;">
                <div style="
                  font-size: 13px;
                  font-weight: 500;
                  color: #3b82f6;
                  display: flex;
                  align-items: center;
                  gap: 4px;
                ">
                  <span>ğŸ•</span>
                  ${vaga.hora_inicio_padrao.substring(0,5)}-${vaga.hora_fim_padrao.substring(0,5)}
                </div>
              </div>
              
              <div style="flex: 0 0 100px;">
                <div style="
                  font-size: 13px;
                  font-weight: 500;
                  color: #374151;
                  display: flex;
                  align-items: center;
                  gap: 4px;
                ">
                  <span>ğŸ“…</span>
                  ${vaga.data_da_vaga.split('-').reverse().join('/')}
                </div>
              </div>
              
              <!-- BotÃ£o Ver Detalhes -->
              <div style="
                flex: 0 0 80px;
                display: flex;
                align-items: center;
                justify-content: flex-end;
              ">
                <button style="
                  padding: 8px 16px;
                  background: #3b82f6;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-size: 12px;
                  font-weight: 600;
                  cursor: pointer;
                  transition: all 0.2s ease;
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  white-space: nowrap;
                  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
                " onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#3b82f6'; this.style.transform='translateY(0)'">
                  <span>ğŸ‘ï¸</span> Ver
                </button>
              </div>
            </div>
          </div>
        `;
      });
      
      // Fechar os containers
      html += `
          </div> <!-- Fim da Ã¡rea de rolagem -->
        </div> <!-- Fim do container principal -->
      `;
      
      vagasListaElement.innerHTML = html;
    }
    
    // FunÃ§Ã£o global para visualizar detalhes da vaga
    function viewVagaDetails(vagaId) {
      console.log('ğŸ” Visualizando detalhes da vaga:', vagaId);
      
      // Usar a funÃ§Ã£o da integraÃ§Ã£o se disponÃ­vel
      if (typeof window.viewVagaDetails === 'function') {
        window.viewVagaDetails(vagaId);
      } else {
        // Fallback bÃ¡sico
        const detailContainer = document.getElementById('detail');
        if (detailContainer) {
          detailContainer.className = 'detail';
          detailContainer.innerHTML = `
            <div class="hdr">
              <div class="title">Detalhes da Vaga #${vagaId}</div>
            </div>
            <div style="padding: 16px;">
              <div style="text-align: center; color: #6b7280;">
                Carregando detalhes da vaga...
              </div>
            </div>
          `;
        }
      }
    }
    
    // FunÃ§Ã£o global para iniciar vaga
    function startVaga(vagaId) {
      console.log('â–¶ï¸ Iniciando vaga:', vagaId);
      
      // Usar a funÃ§Ã£o da integraÃ§Ã£o se disponÃ­vel
      if (typeof window.startVaga === 'function') {
        window.startVaga(vagaId);
      } else {
        // Fallback bÃ¡sico
        if (confirm(`Deseja iniciar a vaga #${vagaId}?`)) {
          alert(`Vaga #${vagaId} iniciada com sucesso!`);
        }
      }
    }
  </script>

  <!-- NavegaÃ§Ã£o entre views (inclui Admin Vagas) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const views = {
        orders: document.getElementById("left-orders"),
        alocacoes: document.getElementById("left-alocacoes"),
        adminV: document.getElementById("left-admin-vagas"),
        encerrarVagas: document.getElementById("left-encerrar-vagas"),
      };
      const buttons = {
        orders: document.getElementById("btn-orders"),
        alocacoes: document.getElementById("btn-alocacoes"),
        adminV: document.getElementById("btn-admin-vagas"),
        encerrarVagas: document.getElementById("btn-encerrar-vagas"),
      };

      function showView(name){
        Object.values(views).forEach(v=>v.classList.add("hidden"));
        views[name].classList.remove("hidden");
        Object.values(buttons).forEach(b=>b.classList.remove("active"));
        buttons[name].classList.add("active");
      }

      buttons.orders.addEventListener("click",()=>{
        showView("orders");
        const d=document.getElementById("detail");
        d.classList.add("empty");
        d.textContent="Selecione um pedido para ver detalhes";
      });





      buttons.alocacoes.addEventListener("click", async () => {
        showView("alocacoes");
        
        // Carregar alocaÃ§Ãµes usando nossa integraÃ§Ã£o
        try {
          if (typeof window.renderAlocacoes === 'function') {
            await window.renderAlocacoes();
          } else {
            console.warn('âš ï¸ MÃ³dulo de integraÃ§Ã£o de alocaÃ§Ãµes nÃ£o carregado');
          }
        } catch (error) {
          console.error('âŒ Erro ao carregar alocaÃ§Ãµes:', error);
        }
        
        const d=document.getElementById("detail");
        d.classList.add("empty");
        d.textContent="Selecione uma alocaÃ§Ã£o para ver detalhes";
      });

      buttons.adminV.addEventListener("click", async ()=>{
        showView("adminV");
        if (window.adminVagas && typeof adminVagas.init==="function") {
          adminVagas.init();
        }
        
        // Definir data atual como padrÃ£o
        const dataInicioInput = document.getElementById("dataInicioVagas");
        if (dataInicioInput) {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const day = String(today.getDate()).padStart(2, '0');
          dataInicioInput.value = `${year}-${month}-${day}`;
        }
        
        // Definir data atual como padrÃ£o para vagas extras
        const dataInicioExtrasInput = document.getElementById("dataInicioVagasExtras");
        if (dataInicioExtrasInput) {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const day = String(today.getDate()).padStart(2, '0');
          dataInicioExtrasInput.value = `${year}-${month}-${day}`;
        }
        
        // Carregar lista de vagas no painel direito
        await carregarListaVagas();
      });

      buttons.encerrarVagas.addEventListener("click", async () => {
        showView("encerrarVagas");
        
        // Definir data atual como padrÃ£o
        const dataEncerrarInput = document.getElementById("dataEncerrar");
        if (dataEncerrarInput) {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const day = String(today.getDate()).padStart(2, '0');
          dataEncerrarInput.value = `${year}-${month}-${day}`;
        }
        
        const d = document.getElementById("detail");
        d.classList.add("empty");
        d.textContent = "Selecione uma data e turno para buscar vagas";
      });
    });
  </script>

  <!-- FunÃ§Ãµes para Encerrar Vagas -->
  <script>
    // Estado das vagas para encerrar
    let vagasParaEncerrar = [];
    
    // Buscar vagas para encerrar
    async function buscarVagasParaEncerrar() {
      const data = document.getElementById("dataEncerrar").value;
      const turno = document.getElementById("turnoEncerrar").value;
      
      if (!data) {
        alert("Selecione uma data!");
        return;
      }
      
      if (!turno) {
        alert("Selecione um turno!");
        return;
      }
      
      console.log('ğŸ” Buscando vagas para encerrar:', { data, turno });
      
      try {
        // Buscar todas as vagas da data
        const response = await window.authManager.authenticatedRequest('/desktop/vagas/', {
          method: 'GET'
        });
        
        if (response.ok) {
          const todasVagas = await response.json();
          console.log('ğŸ“‹ Todas as vagas da data:', todasVagas);
          
          // Filtrar por data e turno
          vagasParaEncerrar = todasVagas.filter(vaga => {
            const vagaData = vaga.data_da_vaga;
            const vagaHoraInicio = vaga.hora_inicio_padrao;
            
            // Verificar se Ã© a data selecionada
            if (vagaData !== data) return false;
            
            // Filtrar por turno
            if (turno === 'manha') {
              return vagaHoraInicio === '08:00:00';
            } else if (turno === 'noite') {
              return vagaHoraInicio === '18:00:00';
            } else if (turno === 'todos') {
              return true;
            }
            
            return false;
          });
          
          console.log('ğŸ“‹ Vagas filtradas para encerrar:', vagasParaEncerrar);
          
          // Mostrar interface
          document.getElementById("vagasEncerrarContainer").style.display = "block";
          
          // Renderizar lista
          renderizarVagasParaEncerrar();
          
        } else {
          throw new Error(`HTTP ${response.status}`);
        }
      } catch (error) {
        console.error('âŒ Erro ao buscar vagas:', error);
        alert(`Erro ao buscar vagas: ${error.message}`);
      }
    }
    
    // Renderizar lista de vagas para encerrar
    function renderizarVagasParaEncerrar() {
      const container = document.getElementById("listaVagasEncerrar");
      
      if (!vagasParaEncerrar.length) {
        container.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #6b7280;">
            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“­</div>
            <div>Nenhuma vaga encontrada para esta data e turno</div>
          </div>
        `;
        return;
      }
      
      let html = '';
      
      vagasParaEncerrar.forEach(vaga => {
        const statusColor = vaga.status === 'aberta' ? '#22c55e' : '#ef4444';
        const statusBg = vaga.status === 'aberta' ? '#dcfce7' : '#fee2e2';
        
        html += `
          <div style="
            border: 1px solid #e5e7eb; 
            margin: 8px 0; 
            background: #ffffff; 
            border-radius: 8px; 
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
          ">
                         <input type="checkbox" 
                    id="vaga_${vaga.id}" 
                    value="${vaga.id}" 
                    style="flex-shrink: 0;">
            
            <div style="flex: 1;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                <span style="font-weight: 600; color: #1f2937;">#${vaga.id}</span>
                <div style="
                  background: ${statusBg};
                  color: ${statusColor};
                  padding: 2px 8px;
                  border-radius: 12px;
                  font-size: 10px;
                  font-weight: 600;
                  text-transform: uppercase;
                ">${vaga.status}</div>
              </div>
              
              <div style="font-size: 12px; color: #6b7280;">
                ${vaga.estabelecimento_nome} â€¢ ${vaga.hora_inicio_padrao.substring(0,5)}-${vaga.hora_fim_padrao.substring(0,5)}
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    // Selecionar/Deselecionar todas as vagas
    function toggleSelectAllVagas() {
      const selectAll = document.getElementById("selectAllVagas");
      const checkboxes = document.querySelectorAll('#listaVagasEncerrar input[type="checkbox"]');
      
      checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
      });
    }
    
    // Encerrar vagas selecionadas
    async function encerrarVagasSelecionadas() {
      const checkboxes = document.querySelectorAll('#listaVagasEncerrar input[type="checkbox"]:checked');
      
      if (!checkboxes.length) {
        alert("Selecione pelo menos uma vaga para encerrar!");
        return;
      }
      
      const vagasIds = Array.from(checkboxes).map(cb => cb.value);
      
      // Verificar se hÃ¡ vagas jÃ¡ encerradas
      const vagasEncerradas = vagasParaEncerrar.filter(vaga => 
        vagasIds.includes(vaga.id.toString()) && vaga.status !== 'aberta'
      );
      
      let mensagem = `Deseja encerrar ${vagasIds.length} vaga(s)?\n\nIDs: ${vagasIds.join(', ')}`;
      
      if (vagasEncerradas.length > 0) {
        const idsEncerradas = vagasEncerradas.map(v => v.id).join(', ');
        mensagem += `\n\nâš ï¸ ATENÃ‡ÃƒO: As vagas ${idsEncerradas} jÃ¡ estÃ£o encerradas e serÃ£o ignoradas.`;
      }
      
      if (!confirm(mensagem)) {
        return;
      }
      
      console.log('ğŸ”š Encerrando vagas:', vagasIds);
      
      try {
        let sucessos = 0;
        let erros = 0;
        
        for (const vagaId of vagasIds) {
          // Verificar se a vaga jÃ¡ estÃ¡ encerrada
          const vaga = vagasParaEncerrar.find(v => v.id.toString() === vagaId);
          if (vaga && vaga.status !== 'aberta') {
            console.log(`âš ï¸ Vaga ${vagaId} jÃ¡ estÃ¡ encerrada, pulando...`);
            continue;
          }
          
          try {
            const response = await window.authManager.authenticatedRequest(`/desktop/vagas/${vagaId}/encerrar/`, {
              method: 'POST'
            });
            
            if (response.ok) {
              sucessos++;
              console.log(`âœ… Vaga ${vagaId} encerrada com sucesso`);
            } else {
              erros++;
              console.error(`âŒ Erro ao encerrar vaga ${vagaId}: ${response.status}`);
            }
          } catch (error) {
            erros++;
            console.error(`âŒ Erro ao encerrar vaga ${vagaId}:`, error);
          }
        }
        
        if (sucessos > 0) {
          alert(`âœ… ${sucessos} vaga(s) encerrada(s) com sucesso!${erros > 0 ? `\nâŒ ${erros} erro(s) encontrado(s).` : ''}`);
          
          // Recarregar lista
          await buscarVagasParaEncerrar();
        } else {
          alert(`âŒ Nenhuma vaga foi encerrada. Verifique os logs para mais detalhes.`);
        }
        
      } catch (error) {
        console.error('âŒ Erro geral ao encerrar vagas:', error);
        alert(`Erro ao encerrar vagas: ${error.message}`);
      }
    }
  </script>



</body>
</html>